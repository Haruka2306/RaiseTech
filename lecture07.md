# 第7回課題
## システムにおけるセキュリティの基礎
* セキュリティの**基本原則**
  * **受容**：そのまま受け入れる、何も対策しない
  * **低減**：影響を減らす対策を実施
  * **移転(転嫁)**：リスク管理を当事者以外に任せる
  * **回避**：リスク辞退を発生させないようにする
####
* 想定されるリスク
  * 主にデータの盗難、改ざん、破壊であり、これらの要因は下記3つ
    * **脆弱性**：バグ設定不備によるシステムの「弱点・穴」　ex. log4j2 問題
    * **認証情報の流失**： 誤って GitHub など公開の場にアップロードした情報を収集している攻撃者が、その情報でログインを試みる。IAM アクセスキーの流出は定期的に発生している。
    * **人為的な過負荷**：多数のコンピュータから連続でリクエストを送り、停止に追いやる。ex. DDoS 攻撃

### 脆弱性
1. アプリケーション<br>

| 対策                                            | 機能説明                                                                                      | 適用状況         |
|-----------------------------------------------|-------------------------------------------------------------------------------------------|--------------|
| **Dependabot**                                | モジュールライブラリの更新を指摘                                                                          | 済（GitHubで管理） |
| **CodeGuru Reviewer**<br><small>※コスト高</small> | Amazon CodeGuruの機能の1つ<br>AIを用いてコードをスキャンし、改善を提案<br>(Dependabotはモジュールの提案以外しない)              | 検討           |
| **AWS WAF**<br>(Web Application Firewall)     | AWSが提供するWAFサービス<br>AWSが提供するルールグループ(AWSManagedRulesCommonRuleSet)のうち、**OWASP TOP 10**をサポート | 検討           |
| **ACM**<br>(AWS Certificate Manager)          | SSL証明書を発行するマネジメントサービス<br>必ずHTTPS(SSL)通信を経由するように設定<br>ドメイン取得が必須                            | 検討           |             |
 <small>※**SSL接続**…SSL証明書を発行し、利用者とWebサーバー間の通信経路を暗号化</small> 

2. OS、ミドルウェア

| 対策            | 機能説明                                                                              | 適用状況 |
|---------------|-----------------------------------------------------------------------------------|------|
| **Inspector** | 脆弱性のスキャンを行うサービス<br>EC2とECRのスキャンに対応<br>自動修復機能はない。**SSM Patch Manager**と併せて適用するとよい。 | 検討   |

3. ネットワーク、その他

| 対策               | 機能説明                                                 | 適用状況 |
|------------------|------------------------------------------------------|------|
| **Security Hub**<br><small>※コスト高</small> | AWSの設定情報を検索して、脆弱な部分を指摘<br>他のAWSのセキュリティ関連サービス結果を集約できる | 検討   |

### 認証情報の流失
1. IAM

| 対策      | 機能説明              | 適用状況        |
|---------|-------------------|-------------|
| **MFA** | 本人以外ログインできないようにする | 済           |
| **ロール** | リソースの操作権限を付与する    | 済(S3へのアクセス) |

2. アプリケーション

| 対策                                  | 機能説明                                                      | 適用状況              |
|-------------------------------------|-----------------------------------------------------------|-------------------|
| **KMS**<br>(Key Management Service) | 暗号鍵マネジメントサービス<br>* EBS、S3などの透過的暗号化<br>* AWS CLIなどを用いた鍵の利用 | 検討(S3の暗号化をKMSに変更) |
| **Secrets Manager**                 | 秘匿しなければならない情報を**KMS**で暗号化して安全に保管、呼び出す| 検討(RDSのパスワードを管理)  |

### 人為的な過負荷

| 対策         | 機能説明                                                                    | 適用状況        |
|------------|-------------------------------------------------------------------------|-------------|
| **Shield** | DDoS攻撃からインフラを保護してくれるマネジメントサービス<br>CloudFront、Route 53，Elastic IPなどをサポート | 済(Standard) |
<small>※**DDoS攻撃**…対象のウェブサイトやサーバーに対して、複数のコンピューターから過剰なアクセスやデーターを送付するサイバー攻撃</small>

## 第5回課題までに構築した環境は、どんな攻撃に対して「脆弱」か？どのような対策が取れるか？
![aws_task5.drawio](/images/lecture05/aws_task5.drawio.png)
* 設定されているセキュリティ
  * IAMユーザーのログインは多要素認証MFAが必要
  * EC2はSSH接続とALBのセキュリティグループからのアクセスを許可
  * RDSはプライベートサブネットに配置して、EC2のセキュリティグループからのみアクセスを許可
  * S3はEC2のセキュリティグループからのみアクセスを許可し、パブリックアクセスは全てブロック
* 現在の環境における脆弱性と対策
  * アプリケーションに脆弱性対策がなされていない→**AWS WAF**を使用し、ルールをALBに設置
  * HTTP通信であるため、のぞき見のリスクが高い→**ACM**を使用。ALBにリスナールールでHTTPアクセスをHTTPSに転送するルールをを追加して、HTTPS通信を経由するように設定
